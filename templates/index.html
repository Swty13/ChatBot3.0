<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Yesteryear&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
 <link rel= "stylesheet" type= "text/css" href= "static/css/style.css">
    <style>
body
    {
     background-image: url("static/images/background.jpg");

    }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

</head>
<body >

     <h1 class="header" >Rajasthan Travel Chatbot</h1>


<div class="container">
    <div class="row">
        <div class="chatbot offset-sm-3">
            <div id="chatbox" class="border border-success">

                <p class="botText"><span><img src="static/images/bot2.jpg" alt="Avatar" style="width:5%;">  Namaste! I am Sana, your travel buddy for Rajasthan</span></p>
            </div>
            <div id="userInput">
                <input id="textInput" class="form-control" type="text" name="msg" placeholder="Type Your Message Here" >
                <input id="buttonInput" class="btn btn-success form-control" type="submit" value="Send">
            </div>
        </div>
    </div>
</div>
</body>
<script>

    function getResponse() {
        var time = new Date();
console.log(
  time.toLocaleString('en-US', { hour: 'numeric', minute: 'numeric', hour12: true })
);
var strTime = time.toLocaleString('en-US', { hour: 'numeric', minute: 'numeric', hour12: true })

        let userText = $("#textInput").val();
        let userHtml = '<p class="userText"><span>' + userText + '   <img src="static/images/user.jpg" alt="Avatar" style="width:5%;"><p class="time" ">'+strTime+'</p></span></p>';
        $("#textInput").val("");
        $("#chatbox").append(userHtml);
        document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
        $.get("/get", { msg: userText }).done(function(data) {

        if(data.indexOf("http://") == 0)
        {
         var loader ='<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>'
        $("#chatbox").append(loader);
        $(".lds-ellipsis").delay(2000).hide(1);
        setTimeout(function () { var botHtml = '<p class="botText" align="right"><span><img src="static/images/bot2.jpg" alt="Avatar" style="width:5%;">  You can plan by reffering this:</span><br><a  href='+data+' target="_blank">'+data+'</a><p class="time-bot" ">'+strTime+'</p></p>';
        $("#chatbox").append(botHtml);}, 2500)

        }
        else
        {
        var i;
        var data1 = '' ;

        var count = data.includes("*")


        if ( count == true)
        {

        for (i = 0; i < data.length; i++)
        {
           if(data[i] == '*')
            {
                break;
            }
              data1 =data1 + data[i] ;
        }
         var loader ='<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>'
        $("#chatbox").append(loader);
        $(".lds-ellipsis").delay(2000).hide(1);
        setTimeout(function () {var data2 = data.slice(i+1,data.length);
            var botHtml = '<a  href='+ data1+' target="_blank"><img id="my-link" src='+data1+' alt=" "></a><p class="botText" align="right"><span><img src="static/images/bot2.jpg" alt="Avatar" style="width:5%;">  '+data2+'<p class="time-bot" ">'+strTime+'</p></span></p>';
            $("#chatbox").append(botHtml);}, 2500)


        }

        else
        {

        var loader ='<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>'
        $("#chatbox").append(loader);
        $(".lds-ellipsis").delay(2000).hide(1);
        setTimeout(function () {var botHtml = '<p class="botText" align="right"><span><img src="static/bot2.jpg" alt="Avatar" style="width:5%;">  ' + data + '<p class="time-bot" ">'+strTime+'</p></span></p>';
        $("#chatbox").append(botHtml).delay(5000).fadeIn();}, 2500)



        }
        }

        document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
});
}
    $("#textInput").keypress(function(e) {
    //if enter key is pressed
        if(e.which == 13) {
            getResponse();
        }
    });
    $("#buttonInput").click(function() {
        getResponse();
    });
</script>


